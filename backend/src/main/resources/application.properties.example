# ============================================
# 应用基础配置
# ============================================
spring.application.name=backend
server.port=8080
server.servlet.context-path=/api

# ============================================
# 数据库配置
# ============================================
spring.datasource.url=jdbc:mysql://localhost:3306/online_class?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 连接池配置
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ============================================
# JPA 配置
# ============================================
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.open-in-view=false

# ============================================
# MyBatis 配置
# ============================================
mybatis.mapper-locations=classpath:mapper/**/*.xml
mybatis.type-aliases-package=com.zzy.backend.entity
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl

# ============================================
# Redis 配置
# ============================================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=0
spring.data.redis.timeout=5000
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# ============================================
# JWT 配置
# ============================================
jwt.secret=${JWT_SECRET:your-secret-key-change-this-in-production-min-256-bits}
jwt.expiration=86400000
jwt.refresh-expiration=604800000

# ============================================
# 文件上传配置
# ============================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB
file.upload.path=./uploads
file.upload.url-prefix=http://localhost:8080/api/uploads

# ============================================
# 阿里云 OSS 配置 (可选，如果使用OSS存储)
# ============================================
aliyun.oss.endpoint=oss-cn-hangzhou.aliyuncs.com
aliyun.oss.access-key-id=${ALIYUN_OSS_ACCESS_KEY_ID:your-access-key-id}
aliyun.oss.access-key-secret=${ALIYUN_OSS_ACCESS_KEY_SECRET:your-access-key-secret}
aliyun.oss.bucket-name=${ALIYUN_OSS_BUCKET_NAME:your-bucket-name}
aliyun.oss.url-prefix=https://your-bucket-name.oss-cn-hangzhou.aliyuncs.com

# ============================================
# 短信服务配置（腾讯云）
# ============================================
sms.provider=tencent
# 腾讯云短信配置（从腾讯云控制台获取）
sms.tencent.secret-id=${TENCENT_SECRET_ID:your-secret-id}
sms.tencent.secret-key=${TENCENT_SECRET_KEY:your-secret-key}
sms.tencent.app-id=${TENCENT_APP_ID:your-app-id}
sms.tencent.sign-name=${TENCENT_SIGN_NAME:your-sign-name}
sms.tencent.template-id=${TENCENT_TEMPLATE_ID:your-template-id}
# 验证码配置
sms.code.expiration=300
sms.code.send-interval=60
sms.code.max-error-count=5
# 发送限制配置
sms.ip.daily-limit=20
sms.phone.daily-limit=10

# ============================================
# 微信登录配置
# ============================================
wechat.app-id=${WECHAT_APP_ID:your-wechat-app-id}
wechat.app-secret=${WECHAT_APP_SECRET:your-wechat-app-secret}
wechat.redirect-uri=http://localhost:8080/api/auth/wechat/callback

# ============================================
# QQ登录配置
# ============================================
qq.app-id=${QQ_APP_ID:your-qq-app-id}
qq.app-key=${QQ_APP_KEY:your-qq-app-key}
qq.redirect-uri=http://localhost:8080/api/auth/qq/callback

# ============================================
# 支付平台配置
# ============================================
# 支付回调地址（需要配置为公网可访问的地址）
payment.callback.alipay.url=http://localhost:8080/api/payment/callback/alipay
payment.callback.wechat.url=http://localhost:8080/api/payment/callback/wechat

# 支付宝配置（需要从支付宝开放平台获取）
alipay.app-id=${ALIPAY_APP_ID:your-alipay-app-id}
alipay.merchant-private-key=${ALIPAY_MERCHANT_PRIVATE_KEY:your-alipay-merchant-private-key}
alipay.alipay-public-key=${ALIPAY_PUBLIC_KEY:your-alipay-public-key}
alipay.sign-type=RSA2
alipay.charset=UTF-8
alipay.gateway-url=https://openapi.alipay.com/gateway.do

# 微信支付配置（需要从微信支付商户平台获取）
wechat.pay.app-id=${WECHAT_PAY_APP_ID:your-wechat-pay-app-id}
wechat.pay.mch-id=${WECHAT_PAY_MCH_ID:your-wechat-pay-mch-id}
wechat.pay.api-key=${WECHAT_PAY_API_KEY:your-wechat-pay-api-key}
wechat.pay.cert-path=classpath:cert/wechat/apiclient_cert.p12

# 定时任务配置
payment.scheduler.enabled=true
payment.scheduler.alipay.enabled=true
payment.scheduler.alipay.cron=0 */5 * * * ?
payment.scheduler.wechat.enabled=true
payment.scheduler.wechat.cron=0 */5 * * * ?
payment.scheduler.batch-size=50

# ============================================
# 跨域配置
# ============================================
cors.allowed-origins=http://localhost:5173,http://localhost:5174,http://localhost:5175,http://localhost:5176,http://192.168.1.128:5173
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true
cors.max-age=3600

# ============================================
# 日志配置
# ============================================
logging.config=classpath:logback-spring.xml
logging.level.root=INFO
logging.level.com.zzy.backend=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.mybatis=DEBUG
logging.level.org.springframework.security=DEBUG

# ============================================
# Actuator 监控配置
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true
management.endpoints.web.base-path=/actuator

