<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zzy.backend.mapper.student.appointment.AppointmentMapper">

    <!-- 预约结果映射 -->
    <resultMap id="AppointmentResultMap" type="com.zzy.backend.entity.student.Appointment">
        <id property="id" column="id"/>
        <result property="orderNo" column="order_no"/>
        <result property="studentId" column="student_id"/>
        <result property="teacherId" column="teacher_id"/>
        <result property="stageId" column="stage_id"/>
        <result property="subjectId" column="subject_id"/>
        <result property="appointmentDate" column="appointment_date"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="duration" column="duration"/>
        <result property="pricePerHour" column="price_per_hour"/>
        <result property="totalAmount" column="total_amount"/>
        <result property="studentName" column="student_name"/>
        <result property="studentGrade" column="student_grade"/>
        <result property="studentPhone" column="student_phone"/>
        <result property="remark" column="remark"/>
        <result property="status" column="status"/>
        <result property="cancelReason" column="cancel_reason"/>
        <result property="cancelBy" column="cancel_by"/>
        <result property="cancelAt" column="cancel_at"/>
        <result property="dingtalkUrl" column="dingtalk_url"/>
        <result property="confirmedAt" column="confirmed_at"/>
        <result property="completedAt" column="completed_at"/>
        <result property="extra" column="extra"/>
        <result property="version" column="version"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="deletedAt" column="deleted_at"/>
    </resultMap>

    <!-- 插入预约记录 -->
    <insert id="insert" parameterType="com.zzy.backend.entity.student.Appointment" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO appointments (
            order_no,
            student_id,
            teacher_id,
            stage_id,
            subject_id,
            appointment_date,
            start_time,
            end_time,
            duration,
            price_per_hour,
            total_amount,
            student_name,
            student_grade,
            student_phone,
            remark,
            status,
            version,
            created_at,
            updated_at
        ) VALUES (
            #{orderNo},
            #{studentId},
            #{teacherId},
            #{stageId},
            #{subjectId},
            #{appointmentDate},
            #{startTime},
            #{endTime},
            #{duration},
            #{pricePerHour},
            #{totalAmount},
            #{studentName},
            #{studentGrade},
            #{studentPhone},
            #{remark},
            #{status},
            #{version},
            #{createdAt},
            #{updatedAt}
        )
    </insert>

    <!-- 根据订单号查询预约 -->
    <select id="selectByOrderNo" resultMap="AppointmentResultMap">
        SELECT *
        FROM appointments
        WHERE order_no = #{orderNo}
          AND deleted_at IS NULL
    </select>

    <!-- 根据ID查询预约 -->
    <select id="selectById" resultMap="AppointmentResultMap">
        SELECT *
        FROM appointments
        WHERE id = #{id}
          AND deleted_at IS NULL
    </select>

</mapper>

