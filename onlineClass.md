# 线上家教接单系统功能需求文档

## 一、项目概述

### 1.1 项目简介
线上家教接单系统是一个连接学生和教师的平台，学生可以查看教师的学历认证、空闲时间段、教学阶段和科目，方便预约课程。系统采用先上课后付费的模式，上课使用钉钉，支付通过转账完成。

### 1.2 核心特点
- 简单易用的预约流程
- 实时聊天沟通功能
- 语音/视频通话功能
- 先上课后付费模式（转账）
- 教师学历认证审核（后台手动审核）

### 1.3 系统架构
- **学生端**：学生浏览教师、预约课程、聊天沟通
- **教师端**：教师管理资料、管理预约、与学生沟通
- **总后台**：用户管理、认证审核、数据统计

---

## 二、学生端功能需求

### 2.0 登录功能

#### 2.0.1 账号密码登录
- 用户名和密码登录
- 支持记住登录状态
- 登录失败提示

#### 2.0.2 手机验证码登录
- 输入手机号
- 发送6位数字验证码（有效期5分钟）
- 验证码登录
- 如果手机号未注册，自动创建账号
- 验证码发送频率限制（1分钟内只能发送一次）

#### 2.0.3 微信登录
- 点击微信登录按钮
- 跳转到微信授权页面
- 用户授权后自动登录
- 首次登录自动创建账号并绑定微信
- 已绑定账号直接登录

#### 2.0.4 QQ登录
- 点击QQ登录按钮
- 跳转到QQ授权页面
- 用户授权后自动登录
- 首次登录自动创建账号并绑定QQ
- 已绑定账号直接登录

#### 2.0.5 登录状态管理
- Token认证机制
- 自动刷新Token
- 登录过期自动跳转登录页
- 支持退出登录

---

### 2.1 教师浏览与筛选

#### 2.1.1 教师列表
- 展示教师基本信息：头像、姓名、学历、评分
- 支持分页加载
- 显示教师在线状态

#### 2.1.2 筛选功能
- **按教学阶段筛选**：小学、初中、高中
- **按科目筛选**：数学、语文、英语、物理、化学等
- **按价格区间筛选**：自定义价格范围
- **按评分筛选**：最低评分要求
- **多条件组合筛选**

#### 2.1.3 搜索功能
- 按教师姓名搜索
- 按科目关键词搜索

### 2.2 教师详情页

#### 2.2.1 基本信息
- 教师头像、姓名、简介
- 教学经验年限
- 学生评价和评分

#### 2.2.2 学历认证
- 学历证书图片展示
- 认证状态标识（已认证/待认证）

#### 2.2.3 教学信息
- **教学阶段**：小学/初中/高中
- **教学科目**：可教授的所有科目
- **课时价格**：元/小时
- **教学风格**：文字描述

#### 2.2.4 空闲时间表
- 日历形式展示
- 显示每周可授课时间段
- 已预约时间段标识
- 支持选择时间段进行预约

#### 2.2.5 学生评价
- 历史评价列表
- 评分统计
- 评价详情展示

### 2.3 预约功能

#### 2.3.1 创建预约
- 从教师空闲时间中选择时间段
- 填写学生信息：姓名、年级、联系方式
- 填写备注信息（学习需求、特殊要求等）
- 提交预约申请

#### 2.3.2 预约列表
- 查看我的所有预约
- **预约状态**：
  - 待确认：等待教师确认
  - 已确认：教师已同意，等待上课
  - 已完成：课程已完成
  - 已取消：预约已取消
- 按状态筛选预约
- 按时间排序

#### 2.3.3 预约详情
- 查看预约完整信息
- 查看钉钉会议链接（已确认后显示）
- 取消预约（待确认/已确认状态可取消）
- 联系教师（跳转聊天页面）

### 2.4 支付功能

#### 2.4.1 支付提醒
- 课程结束后系统提醒支付
- 显示应支付金额
- 显示教师收款信息

#### 2.4.2 转账记录
- 上传转账截图
- 填写转账金额
- 填写转账时间
- 提交支付凭证

#### 2.4.3 支付状态
- 待支付：课程完成，等待支付
- 待确认：已上传转账凭证，等待教师确认
- 已完成：教师已确认收款
- 支付记录查看

### 2.5 实时聊天功能

#### 2.5.1 聊天列表
- 显示所有聊天对象（已预约的教师）
- 显示未读消息数量
- 显示最后一条消息预览
- 显示最后消息时间
- 支持置顶聊天
- 支持搜索聊天记录

#### 2.5.2 聊天窗口
- **文本消息**：发送和接收文字消息
- **语音消息**：录制和发送语音消息（最长5分钟）
- **图片消息**：发送和接收图片
- **文件消息**：发送和接收文件
- **消息状态**：已发送、已送达、已读
- **消息时间显示**：按时间分组显示
- **消息撤回**：2分钟内可撤回

#### 2.5.3 语音通话
- 发起语音通话
- 发起视频通话
- 接听/拒绝通话
- 通话中功能：静音、挂断
- 通话记录查看

---

## 三、教师端功能需求

### 3.1 个人资料管理

#### 3.1.1 基本信息
- 姓名、头像、简介
- 联系方式
- 教学经验年限

#### 3.1.2 学历认证
- 上传学历证书（支持图片格式）
- 认证状态：待审核/已通过/已拒绝
- 审核拒绝原因查看

#### 3.1.3 教学设置
- **教学阶段**：选择可教授的学段（可多选）
- **教学科目**：选择可教授的科目（可多选）
- **课时价格**：设置每个科目的价格（元/小时）

#### 3.1.4 空闲时间管理
- 设置每周可授课时间段
- 支持批量设置（如：每周一、三、五 19:00-21:00）
- 支持临时调整时间段
- 已预约时间段自动标记为不可用

### 3.2 预约管理

#### 3.2.1 预约列表
- 查看所有学生预约
- **预约状态**：
  - 待确认：等待教师确认
  - 已确认：已同意预约
  - 已完成：课程已完成
  - 已取消：预约已取消
- 按状态筛选
- 按时间排序

#### 3.2.2 预约处理
- **确认预约**：同意学生的预约申请
- **拒绝预约**：拒绝预约并填写拒绝原因
- **生成钉钉会议**：确认预约后，填写钉钉会议链接
- **完成课程**：标记课程已完成

#### 3.2.3 预约详情
- 查看学生信息
- 查看预约时间段
- 查看学生备注
- 联系学生（跳转聊天页面）

### 3.3 收款管理

#### 3.3.1 待收款列表
- 查看所有待收款订单
- 显示应收款金额
- 显示学生信息

#### 3.3.2 确认收款
- 查看学生上传的转账截图
- 核对转账金额
- 确认收款（标记订单为已完成）
- 拒绝收款（填写拒绝原因，退回待支付状态）

#### 3.3.3 收款记录
- 查看历史收款记录
- 按时间筛选
- 统计总收款金额

### 3.4 实时聊天功能

#### 3.4.1 聊天列表
- 显示所有聊天对象（已预约的学生）
- 显示未读消息数量
- 显示最后一条消息预览
- 支持置顶聊天

#### 3.4.2 聊天窗口
- 文本消息收发
- 语音消息收发
- 图片消息收发
- 文件消息收发
- 消息状态显示
- 消息撤回功能

#### 3.4.3 语音通话
- 发起语音/视频通话
- 接听/拒绝学生通话
- 通话中控制功能
- 通话记录查看

---

## 四、总后台功能需求

### 4.1 用户管理

#### 4.1.1 学生管理
- 学生列表：查看所有注册学生
- 学生详情：查看学生基本信息
- 账号状态：启用/禁用学生账号
- 学生统计：注册数量、活跃度等

#### 4.1.2 教师管理
- 教师列表：查看所有注册教师
- 教师详情：查看教师完整信息
- 账号状态：启用/禁用教师账号
- 教师统计：注册数量、认证通过率等

### 4.2 认证审核

#### 4.2.1 学历认证审核
- 待审核列表：查看所有待审核的学历认证
- 审核操作：
  - 通过：认证通过，教师可正常接单
  - 拒绝：填写拒绝原因，退回教师修改
- 审核记录：查看历史审核记录

### 4.3 预约管理

#### 4.3.1 预约列表
- 查看所有预约记录
- 按状态筛选
- 按时间筛选
- 预约详情查看

#### 4.3.2 预约统计
- 预约总数统计
- 各状态预约数量
- 完成率统计
- 时间段分布统计

### 4.4 系统设置

#### 4.4.1 基础设置
- 平台名称
- 联系方式
- 客服信息
- 系统公告

---

## 五、实时聊天功能详细设计

### 5.1 技术架构
- **WebSocket 服务**：基于 Swoole WebSocket Server
- **消息存储**：MySQL 数据库
- **实时推送**：WebSocket 双向通信
- **文件存储**：OSS 对象存储（语音、图片、文件）

### 5.2 消息类型

#### 5.2.1 文本消息
- 消息类型：`TYPE_TEXT = 1`
- 内容格式：纯文本
- 最大长度：500 字符

#### 5.2.2 语音消息
- 消息类型：`TYPE_VOICE = 3`
- 内容格式：JSON
  
  {
    "voice_url": "https://oss.example.com/voice/xxx.mp3",
    "duration": 30
  }
  - 最大时长：300 秒（5分钟）
- 支持格式：MP3、M4A、WAV

#### 5.2.3 图片消息
- 消息类型：`TYPE_IMAGE = 4`
- 内容格式：JSON
  {
    "image_url": "https://oss.example.com/image/xxx.jpg",
    "thumbnail_url": "https://oss.example.com/image/xxx_thumb.jpg",
    "width": 1920,
    "height": 1080
  }
  - 支持格式：JPG、PNG、GIF
- 最大大小：10MB

#### 5.2.4 文件消息
- 消息类型：`TYPE_FILE = 2`
- 内容格式：JSON
 
  {
    "file_url": "https://oss.example.com/file/xxx.pdf",
    "file_name": "学习资料.pdf",
    "file_size": 1024000
  }
  - 最大大小：50MB

### 5.3 WebSocket 消息协议

#### 5.3.1 客户端发送消息格式n
{
  "type": "msgText|msgVoice|msgImage|msgFile",
  "friend_user_id": 123,
  "content": "消息内容",
  "voice_url": "语音文件URL（语音消息）",
  "duration": 30,
  "image_url": "图片URL（图片消息）",
  "file_url": "文件URL（文件消息）",
  "file_name": "文件名（文件消息）"
}#### 5.3.2 服务端推送消息格式
{
  "type": "receiveMsg|connect|receiveMsgRead",
  "code": 1,
  "msg": "提示信息",
  "data": {
    "id": 1,
    "relationship_id": 1,
    "sender_id": 123,
    "receiver_id": 456,
    "is_read": 2,
    "type": 1,
    "content": "消息内容",
    "created_at": 1234567890
  }
}### 5.4 聊天关系建立
- 当学生预约教师后，自动建立聊天关系
- 双方可以开始聊天
- 聊天关系持久保存
---

## 六、语音通话功能详细设计

### 6.1 通话类型
- **语音通话**：`call_type = 1`
- **视频通话**：`call_type = 2`

### 6.2 通话状态
- **呼叫中**：`status = 1` - 发起通话，等待接听
- **通话中**：`status = 2` - 对方已接听，正在通话
- **已结束**：`status = 3` - 通话正常结束
- **已拒绝**：`status = 4` - 对方拒绝接听
- **未接听**：`status = 5` - 超时未接听